<!DOCTYPE html>
<html>

<head>
    <meta http-equiv="X-UA-Compatible" content="IE=10" />
    <meta http-equiv="MSThemeCompatible" content="Yes" />
    <meta charset="utf-8" />

    <script src='js/jquery.js'> </script>
    <script src='js/skalp.js'> </script>
    <link rel='stylesheet' href='css/hatch_dialog.css' />

    <link href="css/jquery-ui-1.10.4.custom.min.css" rel="stylesheet" />
    <script type="text/javascript" src="js/jquery-ui.min.js"></script>

    <link rel="stylesheet" type="text/css" href="css/jscslider.css">
    <script type="text/javascript" src="js/jscslider.js"></script>

    <!-- Spectrum Color Picker -->
    <link rel="stylesheet" type="text/css" href="css/spectrum.css">
    <script type="text/javascript" src="js/spectrum.js"></script>

    <title>Skalp Pattern Designer</title>

</head>

<body onload="ready_hatch()" onfocus="onfocus_hatch()" scroll="no" style="OVERFLOW: hidden">

    <!-- Material Name -->
    <div id="material_name_div">
        <label for="hatch_name">Name:</label>
        <input type='text' title='Material name' id='hatch_name'>
    </div>

    <!-- Preview with inline zoom slider -->
    <div id="preview_container">
        <img class="preview" id="hatch_preview" src='icons/skalp_empty.png'>
        <div id="preview_zoom_row">
            <h2 id="translate_03">Preview Zoom:</h2>
            <input type="number" min="5" max="100" value="60" class="slider" id="slider" onchange="create_preview(0)">
        </div>
    </div>

    <div id="pattern_settings">

        <!-- Pattern definition Section -->
        <div class="section">
            <div class="section-header" onclick="toggleSection('autocad_section')">
                <span class="toggle-icon">▼</span>
                <h3>Pattern definition</h3>
            </div>
            <div id="autocad_section" class="section-content">
                <!-- Tile Size -->
                <div class="field-row">
                    <label>Tile Size:</label>
                    <div class="field-inputs">
                        <input type='text' class="drawing_scale tile-input" title='Define Pattern Height' id='tile_y'
                            style="color: #CC0000;">
                        <img src='icons/gauge.png' id="tile_operator">
                        <input type='text' class="drawing_scale tile-input" title='Define Pattern Width' id='tile_x'
                            style="color: #00AA00;">
                    </div>
                </div>

                <!--Pattern -->
                <div class="field-row">
                    <label for="acad_pattern_list">Pattern:</label>
                    <select id="acad_pattern_list" onchange="select_pattern(this.value)"></select>
                </div>

                <!-- Type -->
                <div class="field-row">
                    <label for="units">Type:</label>
                    <select id="units" onchange="units(this.value)">
                        <option value='paperspace'>Drawing Scale Dependent</option>
                        <option value='modelspace'>Absolute Size</option>
                    </select>
                </div>
            </div>
        </div>

        <!-- Pattern styling Section -->
        <div class="section">
            <div class="section-header" onclick="toggleSection('pattern_section')">
                <span class="toggle-icon">▼</span>
                <h3>Pattern styling</h3>
            </div>
            <div id="pattern_section" class="section-content">
                <!-- Pattern Fill Color -->
                <div class="field-row">
                    <label id="translate_06">Fill Color:</label>
                    <div class="color-block" id="fill_color" style="background-color: #FFFFFF;"
                        onclick="document.getElementById('fill_color_input').click()"></div>
                    <input type="color" id="fill_color_input" class="basic1" style="display:none;"
                        onchange="updateFillColor(this.value)" value="#FFFFFF">
                </div>

                <!-- Pattern Line Color -->
                <div class="field-row">
                    <label id="translate_17">Line Color:</label>
                    <div class="color-block" id="line_color" style="background-color: #000000;"
                        onclick="document.getElementById('line_color_input').click()"></div>
                    <input type="color" id="line_color_input" class="basic2" style="display:none;"
                        onchange="updateLineColor(this.value)" value="#000000">
                </div>

                <!-- Pattern Line Width Paper -->
                <div class="field-row">
                    <label id="translate_08">Line Width:</label>
                    <select id='lineweight_paper' onchange="$('#update_preview').show();create_preview(0);">
                        <option value='0.04 mm'>0.04 mm</option>
                        <option value='0.07 mm'>0.07 mm</option>
                        <option value='0.13 mm'>0.13 mm</option>
                        <option value='0.18 mm'>0.18 mm</option>
                        <option value='0.25 mm'>0.25 mm</option>
                        <option value='0.35 mm'>0.35 mm</option>
                        <option value='0.50 mm'>0.50 mm</option>
                        <option value='0.70 mm'>0.70 mm</option>
                        <option value='1.00 mm'>1.00 mm</option>
                        <option value='2.00 mm'>2.00 mm</option>
                        <option value='0.1 pt'>0.1 pt</option>
                        <option value='0.2 pt'>0.2 pt</option>
                        <option value='0.4 pt'>0.4 pt</option>
                        <option value='0.6 pt'>0.6 pt</option>
                        <option value='0.8 pt'>0.8 pt</option>
                        <option value='1.0 pt'>1.0 pt</option>
                        <option value='1.5 pt'>1.5 pt</option>
                        <option value='2.0 pt'>2.0 pt</option>
                        <option value='3.0 pt'>3.0 pt</option>
                        <option value='4.0 pt'>4.0 pt</option>
                        <option value='5.0 pt'>5.0 pt</option>
                    </select>
                    <!-- Hidden lineweight_model for skalp.js compatibility -->
                    <input type="hidden" id="lineweight_model" value="0.35 mm">
                </div>
            </div>
        </div>

        <!-- Section styling Section -->
        <div class="section">
            <div class="section-header" onclick="toggleSection('section_section')">
                <span class="toggle-icon">▼</span>
                <h3>Section styling</h3>
            </div>
            <div id="section_section" class="section-content">
                <!-- Section Line Color -->
                <div class="field-row">
                    <label id="translate_18">Line Color:</label>
                    <div class="color-block" id="section_line_color" style="background-color: #000000;"
                        onclick="document.getElementById('section_line_color_input').click()"></div>
                    <input type="color" id="section_line_color_input" class="basic3" style="display:none;"
                        onchange="updateSectionLineColor(this.value)" value="#000000">
                </div>

                <!-- Section Line Width -->
                <div class="field-row">
                    <label id="translate_05">Line Width:</label>
                    <select id='sectioncut_linewidth' onchange="$('#update_preview').show();create_preview(0);">
                        <option value='0.00 mm'>none</option>
                        <option value='0.04 mm'>0.04 mm</option>
                        <option value='0.07 mm'>0.07 mm</option>
                        <option value='0.13 mm'>0.13 mm</option>
                        <option value='0.18 mm'>0.18 mm</option>
                        <option value='0.25 mm'>0.25 mm</option>
                        <option value='0.35 mm'>0.35 mm</option>
                        <option value='0.50 mm'>0.50 mm</option>
                        <option value='0.70 mm'>0.70 mm</option>
                        <option value='1.00 mm'>1.00 mm</option>
                        <option value='2.00 mm'>2.00 mm</option>
                        <option value='0.1 pt'>0.1 pt</option>
                        <option value='0.2 pt'>0.2 pt</option>
                        <option value='0.4 pt'>0.4 pt</option>
                        <option value='0.6 pt'>0.6 pt</option>
                        <option value='0.8 pt'>0.8 pt</option>
                        <option value='1.0 pt'>1.0 pt</option>
                        <option value='1.5 pt'>1.5 pt</option>
                        <option value='2.0 pt'>2.0 pt</option>
                        <option value='3.0 pt'>3.0 pt</option>
                        <option value='4.0 pt'>4.0 pt</option>
                        <option value='5.0 pt'>5.0 pt</option>
                    </select>
                </div>

                <!-- Unify Material -->
                <div class="field-row">
                    <label title="Coming Soon">Join Section Lines:</label>
                    <input type="checkbox" name="unify material" value="unify" id="unify_material" disabled
                        title="Coming Soon">
                </div>
            </div>
        </div>

        <!-- Options Section -->
        <div class="section">
            <div class="section-header" onclick="toggleSection('options_section')">
                <span class="toggle-icon">▼</span>
                <h3>Options</h3>
            </div>
            <div id="options_section" class="section-content">
                <!-- Align with Objects -->
                <div class="field-row">
                    <label id='translate_18'
                        title="Align red X-axis with the longest Edge in an Objects section result">Align with
                        Objects:</label>
                    <input type="checkbox" name="align with object" value="align" id="align_pattern"
                        title="Align red X-axis with the longest Edge in an Objects section result"
                        onchange="$('#update_preview').show();">
                </div>

                <!-- Z-Index -->
                <div class="field-row">
                    <label title="Coming Soon">Z-Index:</label>
                    <select id="zindex" disabled title="Coming Soon">
                        <option value="-3">-3</option>
                        <option value="-2">-2</option>
                        <option value="-1">-1</option>
                        <option value="0" selected>0</option>
                        <option value="+1">+1</option>
                        <option value="+2">+2</option>
                        <option value="+3">+3</option>
                    </select>
                </div>
            </div>
        </div>

    </div>

    <!-- Footer with CANCEL and SAVE buttons -->
    <div class="dialog-footer">
        <button class="btn-cancel" onclick="cancel_edit()">CANCEL</button>
        <button class="btn-save" onclick="save_material()">SAVE</button>
    </div>

    <script>
        // Toggle section expand/collapse
        function toggleSection(sectionId) {
            const section = document.getElementById(sectionId);
            const header = section.previousElementSibling;
            const icon = header.querySelector('.toggle-icon');

            if (section.classList.contains('collapsed')) {
                section.classList.remove('collapsed');
                icon.textContent = '▼';
            } else {
                section.classList.add('collapsed');
                icon.textContent = '▶';
            }

            // Adjust window height after transition
            setTimeout(updateWindowHeight, 350);
        }

        function updateWindowHeight() {
            var body = document.body;
            var height = body.scrollHeight + 5; // Use scrollHeight + small buffer
            var width = 235; // Target fixed width inclusive of 10px margins
            if (typeof sketchup !== 'undefined' && sketchup.resize_window) {
                sketchup.resize_window(width, height);
            }
        }

        // Initialize height on load
        window.onload = function () {
            ready_hatch();
            updateWindowHeight();
        };

        // Color picker functions
        function updateFillColor(color) {
            document.getElementById('fill_color').style.backgroundColor = color;
            create_preview(0);
        }

        function updateLineColor(color) {
            document.getElementById('line_color').style.backgroundColor = color;
            $('#update_preview').show();
            create_preview(0);
        }

        function updateSectionLineColor(color) {
            document.getElementById('section_line_color').style.backgroundColor = color;
            $('#update_preview').show();
            create_preview(0);
        }
        function save_material() {
            var materialName = document.getElementById('material_name').value;
            if (!materialName || materialName.trim() === '') {
                alert('Please enter a material name');
                return;
            }
            sketchup.save_material(materialName);
        }

        function cancel_edit() {
            sketchup.cancel_edit();
        }

        function create_preview(force) {
            var pattern = document.getElementById('acad_pattern_list') ? document.getElementById('acad_pattern_list').value : '';
            var tile_x = document.getElementById('tile_x') ? document.getElementById('tile_x').value : '';
            var tile_y = document.getElementById('tile_y') ? document.getElementById('tile_y').value : '';
            var lineColorInput = document.getElementById('line_color_input');
            var fillColorInput = document.getElementById('fill_color_input');
            var lineColor = lineColorInput ? lineColorInput.value : '#000000';
            var fillColor = fillColorInput ? fillColorInput.value : '#ffffff';
            var units = document.getElementById('units') ? document.getElementById('units').value : '';
            var lineweight = document.getElementById('lineweight_paper') ? document.getElementById('lineweight_paper').value : '';
            var slider = document.getElementById('slider') ? document.getElementById('slider').value : '60';
            var isNew = force == 1 ? '1' : '0';
            var aligned = document.getElementById('align_pattern') && document.getElementById('align_pattern').checked ? 'true' : 'false';
            var sectionCutWidth = document.getElementById('sectioncut_linewidth') ? document.getElementById('sectioncut_linewidth').value : '';
            var materialName = document.getElementById('hatch_name') ? document.getElementById('hatch_name').value : '';

            var params = [
                pattern,
                tile_x,
                tile_y,
                lineColor,
                fillColor,
                lineColor,
                fillColor,
                slider,
                isNew,
                aligned,
                sectionCutWidth,
                materialName
            ].join(';');

            sketchup.create_preview(params);
        }
    </script>

    <!-- RUBY BRIDGE -->
    <input id="RUBY_BRIDGE" type="hidden">
    <input id="gauge_ratio" type="hidden">
    <input id="max_height" type="hidden" value=800>
    <input id="min_height" type="hidden" value=500>
    <input id="min_width" type="hidden" value=300>

</body>

</html>